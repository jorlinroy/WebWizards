<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Incident Management</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Incident Management System</h1>
  </header>
  <main>
    <button onclick="window.location.href='create.html'">Create New Incident</button>
    <div id="incident-list"></div>
  </main>
  <script>
    async function fetchIncidents() {
      try {
        const response = await fetch("http://127.0.0.1:5000/api/incidents");
        const incidents = await response.json();
        document.getElementById("incident-list").innerHTML = incidents.length > 0 ?
          incidents.map(incident => `
            <div>
              <h2>${incident.title}</h2>
              <p><strong>Status:</strong> ${incident.status}</p>
              <p><strong>Priority:</strong> ${incident.priority}</p>
              <p><strong>Reported By:</strong> ${incident.reportedBy}</p>
              <button onclick="deleteIncident('${incident._id}')">Delete</button>
              <button onclick="window.location.href='update.html?id=${incident._id}'">Update</button>
            </div>
          `).join("") : "<p>No incidents found</p>";
      } catch (error) {
        alert("Failed to fetch incidents.");
      }
    }

    async function deleteIncident(id) {
      if (confirm("Are you sure you want to delete this incident?")) {
        await fetch(`http://127.0.0.1:5000/api/incidents/${id}`, { method: "DELETE" });
        fetchIncidents();
      }
    }

    fetchIncidents();
  </script>
</body>
</html>
